package edu.csu2017fa314.DemoServer.Server;

import com.google.gson.Gson;
import com.google.gson.JsonElement;
import com.google.gson.JsonParser;
import spark.Request;
import spark.Response;

import static spark.Spark.post;

/**
 * Created by sswensen on 10/1/17.
 */

public class Server {
    public static void main(String[] args) {
        Server s = new Server();
        s.serve();
    }

    public void serve() {
        Gson g = new Gson();
        post("/testing", this::testing, g::toJson); //Create new listener
    }

    private Object testing(Request rec, Response res) {
        setHeaders(res); //Set the return headers
        JsonParser parser = new JsonParser();
        JsonElement elm = parser.parse(rec.body()); //Grab the json body from POST
        Gson gson = new Gson();
        DataClass test = gson.fromJson(elm, DataClass.class); //Create new Object from received elm
        //The object generated by the frontend should match whatever class you are reading into.
        //Notice how DataClass has name and ID and how the frontend is generating an object with name and ID.

        return test.getName().length(); //What to return to the server, in this example, returning length of recieved string
    }

    private void setHeaders(Response res) {
        res.header("Content-Type", "application/json"); // Declares returning type json
        res.header("Access-Control-Allow-Origin", "*"); // Ok for browser to call even if different host host
        res.header("Access-Control-Allow-Headers", "*");
    }
}